<header class="header">
    <div class="header-content">
        <h2 class="page-title">{% block page_title %}{% endblock %}</h2>
        <div class="header-actions">
            <button class="btn-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
            </button>
            <button class="btn-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                    <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                </svg>
            </button>
            {% if request.user.is_authenticated %}
            <div class="user-menu" style="display:inline-block;margin-left:8px;">
                <button class="user-avatar user-menu-toggle" aria-haspopup="true" aria-expanded="false" title="Cuenta">
                    <span>{{ request.user.username|slice:":2"|upper }}</span>
                </button>
                <div class="user-menu-dropdown" role="menu" aria-hidden="true">
                    <a class="user-menu-item" href="{% url 'users:profile' %}">Perfil</a>
                    <form method="post" action="{% url 'logout' %}" class="logout-form" style="margin:0;">
                        {% csrf_token %}
                        <button type="submit" class="user-menu-item" style="background:none;border:none;padding:8px 12px;text-align:left;width:100%;">Cerrar sesión</button>
                    </form>
                </div>
            </div>
            {% else %}
            <div style="display:inline-flex; gap:8px; align-items:center; margin-left:8px;">
                <a href="{% url 'login' %}" class="btn-secondary">Iniciar sesión</a>
                <a href="{% url 'users:signup' %}" class="btn-primary">Crear cuenta</a>
            </div>
            {% endif %}
        </div>
    </div>
</header>
<script>
document.addEventListener('DOMContentLoaded', function () {
    // logout confirmation (if present)
    var logoutForm = document.querySelector('.logout-form');
    if (logoutForm) {
        logoutForm.addEventListener('submit', function (e) {
            var ok = confirm('¿Estás seguro que quieres cerrar sesión?');
            if (!ok) {
                e.preventDefault();
            }
        });
    }

    // user menu dropdown toggle
    var toggles = document.querySelectorAll('.user-menu-toggle');
    toggles.forEach(function(btn){
        btn.addEventListener('click', function(e){
            e.stopPropagation();
            var menu = btn.closest('.user-menu').querySelector('.user-menu-dropdown');
            var expanded = btn.getAttribute('aria-expanded') === 'true';
            btn.setAttribute('aria-expanded', (!expanded).toString());
            if (menu) menu.setAttribute('aria-hidden', expanded ? 'true' : 'false');
        });
    });

    // close when clicking outside
    document.addEventListener('click', function(){
        document.querySelectorAll('.user-menu-dropdown').forEach(function(menu){
            menu.setAttribute('aria-hidden','true');
        });
        document.querySelectorAll('.user-menu-toggle').forEach(function(btn){
            btn.setAttribute('aria-expanded','false');
        });
    });
});
</script>
